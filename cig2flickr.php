<?phprequire_once('lib/curl/curl.php');require_once('lib/simple_html_dom/simple_html_dom.php');include('cig2flickr.config.php');if (!extension_loaded('curl')){	die('Unable to find curl module');}if (!file_exists('cig2flickr.config.php')){	die('Unable to find configuration file');}// Variables$cig_auth_url = 'https://www.cig.canon-europe.com/pe/f/authenticate.do?UseNSession=No';$cig_home_url = 'http://www.cig.canon-europe.com/photoAlbum';$cig_items_url = 'http://opa.cig2.canon-europe.com/internal/timeline/grid';$cig_item_url = 'http://opa.cig2.canon-europe.com/item/';// Connect to Canon Image Gateway$curl = new Curl;$curl->cookie_file = '/tmp/test.txt';$response = $curl->post($cig_auth_url, array('username' => CIG_USERNAME, 'password' => CIG_PASSWORD));if ($response->headers['Status-Code'] != 200 || stripos($response->body, 'error')){	die('Unable to properly authenticate to CIG');}$response = $curl->get($cig_home_url);if ($response->headers['Status-Code'] != 200){	die('Unable to access CIG homepage');}// Retrieve token$html = str_get_html($response->body);$ret = $html->find('input[name=ct__]', 0); $ct = $ret->value;$response = $curl->post($cig_items_url, array('ct__' => $ct));if ($response->headers['Status-Code'] != 200){	die('Unable to retrieve items list');}$data = json_decode($response->body);foreach ($data->itemList as $item){	$id = $item->it__;	$title = $item->title;		$response = $curl->get($cig_item_url . $id);		$html = str_get_html($response->body);	$ret = $html->find('input[id=itemDownloadStandByUrl00]', 0); 	$downloadurl = $ret->value;	header('Content-Type: image/jpg');	echo file_get_contents($downloadurl);	exit;}